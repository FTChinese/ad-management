<script>
var tag = '[[name=标签,width=250,type=textfield,default=企业公告]]';
var headline = '[[name=标题,width=250,type=textfield,allowblank=true]]';
var lead = '[[name=导语,width=250,type=textfield,allowblank=true]]';
var image = '[[name=配图,width=250,type=textfield,allowblank=true]]';
var bgColor = '[[name=底色（0~4）,width=250,type=textfield,allowblank=true,default=0]]';
var Click = '[URL]';
var Imp = '[[name=第三方监测,type = textfield,allowblank = true,width=250]]';
var positionNum = '[[name=位置序号(4~16),type=textfield,default=11]]';
var AdName = 'PaidpostStory';
var AssID = '[ASSID]';

if (Imp !== '') {
  if (typeof window.parent.sendImpToThirdParty === 'function') {
      window.parent.sendImpToThirdParty(Imp, AdName, AssID);
  } else {
      sendImpToThirdParty(Imp, AdName, AssID);
  }
}

function sendImpToThirdParty(t,e,n){if("string"==typeof t){"object"!=typeof window.parent.gTrackThirdParyImpression&&(window.parent.gTrackThirdParyImpression={});var r=0,a=t,i=!1,o=function(){var t=arguments[0]||"",e=arguments[1]||"",r=arguments[2]||"",a="G"+Math.round(1e12*Math.random());try{window.parent.ga("send","event",t,e,r,{nonInteraction:1})}catch(i){(new Image).src="http://www.ftchinese.com/index.php/ft/hit/"+n+"/2?ec="+t+"&ea="+e+"&el="+encodeURIComponent(r)+"&r="+a}},c=function(){var d,s="IMG"+Math.round(1e12*Math.random()),p=(new Date).getTime(),h=t;try{d=arguments[0]||""}catch(t){d=""}h.indexOf("?")<0&&(h+="?"),h=h.replace("ord=[timestamp]","ord="+p)+"&"+s+"&ftctime="+p,r>0&&(h=0===a.indexOf("https")?(h=h.replace("https://ad.doubleclick.net","http://ad.doubleclick.net")).replace("https://v.admaster.com.cn","http://v.admaster.com.cn"):(h=h.replace("http://ad.doubleclick.net","https://ad.doubleclick.net")).replace("http://v.admaster.com.cn","https://v.admaster.com.cn")),a=h,window.parent.gTrackThirdParyImpression[s]=new Image,window.parent.gTrackThirdParyImpression[s].src=h,window.parent.gTrackThirdParyImpression[s].title=e+" ("+n+")",window.parent.gTrackThirdParyImpression[s].alt=t,window.parent.gTrackThirdParyImpression[s].onload=function(){var t="";t=0===r?"Success":""!==d?"Success on Retry"+d:"Success on Retry"+r,o(this.title,t,this.alt),delete window.parent.gTrackThirdParyImpression[s],i=!0},window.parent.gTrackThirdParyImpression[s].onerror=function(){var t="";if(t=0===r?"Fail":""!==d?"Fail on Retry"+d:"Fail on Retry"+r,o(this.title,t,this.alt),o("Fail UA String",n,window.parent.adReachability()),"string"==typeof window.uaString)try{window.parent._hmt.push(["_trackEvent",this.title,"Fail",window.uaString])}catch(t){}++r<=3&&setTimeout(c,100*r*r*r)}};c(),setTimeout(function(){if(!1===i&&0===r){r=2;c(" from Pending"),o(e+" ("+n+")","Request from Pending",t)}},1e4),o(e+" ("+n+")","Request",t)}}



switch (bgColor) {
case '0':
    backgroundColorByUser = 'white';
    break;
case '1':
    backgroundColorByUser = '#fbe9da';
    break;
case '2':
    backgroundColorByUser = '#f3dec8';
    break;
case '3':
    backgroundColorByUser = 'transparent';
    break;
case '4':
    backgroundColorByUser = '#f6e9d8';
    break;
default:
    backgroundColorByUser = 'white';
}
var templateHTML ='<div class="item-inner" style="background:'+backgroundColorByUser+';"><h2 class="item-headline"><div class="item-tag">'+tag+'<button class="myft-follow plus" data-tag="'+ tag +'" data-type="tag">关注</button></div><a target="_blank" href="'+ Click +'">'+ headline +'</a></h2><a class="image" target="_blank" href="'+ Click +'"><figure class="" data-url="'+image+'"><img src="https://www.ft.com/__origami/service/image/v2/images/raw/'+ image+'?source=ftchinese&amp;width=250&amp;height=141&amp;fit=cover&amp;from=next001" data-backupimage="https://www.ft.com/__origami/service/image/v2/images/raw/' + image +'?source=ftchinese&amp;width=250&amp;height=141&amp;fit=cover&amp;from=next001"></figure></a><div class="item-lead">'+ lead +'</div><div class="item-bottom"></div></div>';

var paidpostStoryElem = document.createElement('div');
paidpostStoryElem.className = "item-container";
paidpostStoryElem.style.background = bgColor;
paidpostStoryElem.innerHTML = templateHTML;


var listContainer = window.parent.document.querySelector('.list-container .items');
var itemContainers = listContainer.querySelectorAll('.item-container');
var oldListItemCount = itemContainers.length;

var insertBeforeItem = itemContainers.item(positionNum-1).previousElementSibling;

insertBeforeItem.parentNode.insertBefore(paidpostStoryElem,insertBeforeItem);


var paidpostTopElem = document.createElement('div');
paidpostStoryElem.parentNode.insertBefore(paidpostTopElem, paidpostStoryElem);

var listItemCount = oldListItemCount + 1;
var itemsArray = listContainer.querySelectorAll('.item-container');
for(var i=0; i<listItemCount; i++) {
    var itemContainer = itemsArray.item(i);
    var topLineContainer = itemContainer.previousElementSibling;
    var XL="",L="",M="",S="",P="",itemTopClass="";

    if (listItemCount % 3 == 0) {
        
        if (i == 0) { 
            XL = "XL8"; 
        } else {
            XL = "XL4";
        }
        if (i % 3 == 0 ) {
            itemTopClass = "XLT";
        }

    } else if (listItemCount % 3 == 1) {
        if (i == 0) {
            XL = "XL8"; 
        } else if (i == listItemCount-1) {
            XL = "XL4 XL-half XL-lower";
        } else if(i == listItemCount-2) {
            XL = "XL4 XL-half";
        } else {
            XL = "XL4";
        }

        if (i != listItemCount - 1 && i % 3 == 0) {
            itemTopClass = "XLT"
        }

    } else if (listItemCount % 3 == 2) {
        if (i == 0) {
            XL = "XL8";
        } else if ( i >= listItemCount - 2) { 
            XL = "XL4 XL-half XL-lower";
        } else if ( i >= listItemCount - 4) { 
            XL = "XL4 XL-half";
        } else {
            XL = "XL4";
        }

        if ( i < listItemCount - 4 && i%3 == 0 ) {
            itemTopClass = "XLT";
        } else if ( i == listItemCount - 2 ) {
            itemTopClass = "XLT-clear-right";
        }
    

    }

    if (listItemCount % 3 == 0 ) {
        if (i == 0) {
            L = "L8";
        } else {
            L = "L4";
        }
        if (i % 3 == 0) {
            itemTopClass = itemTopClass + " LT"
        } 
    } else if ( listItemCount % 3 == 1) {
        if (i == 0) {
            L = "L8";
        } else if (i == listItemCount - 1) {
            L = "L4 L-half L-lower";
        } else if ( i == listItemCount - 2) {
            L = "L4 L-half";
        } else {
            L = "L4";
        }
        if (i != listItemCount - 1 && i % 3 == 0) {
            itemTopClass = itemTopClass + " LT";
        }
    } else if ( listItemCount % 3 == 2) {
        if (i == 0) {
            L = "L8";
        } else if (i >= listItemCount - 2) {
            L = "L4 L-half L-lower";
        } else if (i >= listItemCount - 4) {
            L = "L4 L-half";
        } else {
            L = "L4";
        }

        if ((i < listItemCount - 4) && (i % 3 == 0)) {
            itemTopClass = itemTopClass + " LT";
        } else if (i == listItemCount - 2) {
            itemTopClass = itemTopClass + " LT-clear-right"
        }
    }

    if (i==0) {
        M = "M12";
        P = "P12";
    } else {
        M = "M12 M-half";
        P = "P12 P-half";
        itemTopClass = itemTopClass + " MT PT";
    }
    

    if (listItemCount % 2 == 1 && i == 0) {
        S = "S12 S-double-width";
    } else {
        S = "S6";
        if ((i % 2 == 0 && listItemCount % 2 == 0) || (i % 2 == 1 && listItemCount % 2 == 1)) {
            itemTopClass = itemTopClass + " ST"  
        }
    }
    

    
    if (itemTopClass != "" && topLineContainer) {
        topLineContainer.className = itemTopClass;
    }
    if (i == 0 || i >= positionNum-1) {         
        var itemContainerClass = "item-container " + XL + " " + L + " " + M + " " + S + " " + P;

        if (itemContainer.classList.contains("has-image")) {
            itemContainerClass = itemContainerClass += " has-image";

            if(i>= listItemCount-4 ) {
                var theFigure = itemContainer.querySelector('figure');
                theFigure.innerHTML = '';
                theFigure.className = 'loading';
            }
        }
        itemContainer.className = itemContainerClass;
    }
}
if (window.parent.loadImages) {
    window.parent.loadImages();
}
</script>